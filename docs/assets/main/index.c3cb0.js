window.__require=function t(e,i,s){function o(c,r){if(!i[c]){if(!e[c]){var h=c.split("/");if(h=h[h.length-1],!e[h]){var a="function"==typeof __require&&__require;if(!r&&a)return a(h,!0);if(n)return n(h,!0);throw new Error("Cannot find module '"+c+"'")}c=h}var p=i[c]={exports:{}};e[c][0].call(p.exports,function(t){return o(e[c][1][t]||t)},p,p.exports,t,e,i,s)}return i[c].exports}for(var n="function"==typeof __require&&__require,c=0;c<s.length;c++)o(s[c]);return o}({GraphicsEdit:[function(t,e){"use strict";cc._RF.push(e,"1d56fbRtdJK2I5Zy+zK5lxZ","GraphicsEdit"),cc.Class({extends:cc.Component,properties:{uiGraph:cc.Graphics,posLabel:cc.Label,uiNode:cc.Node,qzCheck:cc.Toggle,fillCheck:cc.Toggle,btnddd:cc.Node,move:cc.Prefab,moveCtr:cc.Prefab,line:cc.Prefab,lineCtr:cc.Prefab,quadratic:cc.Prefab,quadraticCtr:cc.Prefab,bezier:cc.Prefab,bezierCtr:cc.Prefab,close:cc.Prefab,closeCtr:cc.Prefab,arc:cc.Prefab,arcCtr:cc.Prefab,ctrContainer:cc.Node,optPanel:t("optpanel"),feiji:cc.Node,resultPop:cc.Node,resultEdit:cc.EditBox},onLoad:function(){this.gid=0,this.graphNodes=[],this.width=2e3,this.height=2e3,this.baseScale=20,this.lineWidth=.1,this.handleWidth=.3,this.ctrlColor=cc.Color.GRAY,this.pointColor=cc.Color.WHITE,this.mouseEnterColor=cc.Color.RED,this.mouseSelColor=cc.color().fromHEX("#00aeff"),this.mouseEnterNode=null,this.mouseSelNode=null,this.creatingNode=null,this.uiGraph.node.scale=this.baseScale,this.feiji.scale=.05,this.optPanel.init(this),this.initEvent();var t=this.genGNode(null,"move",!0);t.init(this,cc.v2(-6,3),cc.v2(-6,3)),this.genCtr("move",t,0),(t=this.genGNode(null,"quadratic",!0)).init(this,cc.v2(-6,3),cc.v2(-10,13),cc.v2(-4,14)),this.genCtr("quadratic",t,1),(t=this.genGNode(null,"line",!0)).init(this,cc.v2(-4,14),cc.v2(7,16)),this.genCtr("line",t,2),(t=this.genGNode(null,"bezier",!0)).init(this,cc.v2(7,16),cc.v2(23,16),cc.v2(27,14),cc.v2(24,9)),this.genCtr("bezier",t,3)},update:function(){this.drawHelpUI(),this.drawGraph()},drawHelpUI:function(){var t=this.uiGraph;t.clear(),this.uiGraph.fillColor=cc.color().fromHEX("#1e1e1e");var e=this.width,i=this.height,s=this.baseScale;t.rect(-e/2,-i/2,e,i),t.fill(),t.lineWidth=.09,t.strokeColor=cc.color().fromHEX("#353536");for(var o=-i/2;o<i/2;o++)0!=o&&(t.moveTo(-e/2,o),t.lineTo(e/2,o),t.stroke());for(var n=-e/2;n<e/2;n++)0!=n&&(t.moveTo(n,-i/2),t.lineTo(n,i/2),t.stroke());t.stroke(),t.lineWidth=.2*s/t.node.scale,t.strokeColor=cc.Color.RED,t.moveTo(-e/2,0),t.lineTo(e/2,0),t.stroke(),t.lineWidth=.2*s/t.node.scale,t.strokeColor=cc.Color.GREEN,t.moveTo(0,-i/2),t.lineTo(0,i/2),t.stroke()},drawGraph:function(){var t=this.uiGraph;t.fillColor=cc.color(255,255,255,64),t.lineWidth=this.lineWidth*this.baseScale/t.node.scale,t.strokeColor=this.pointColor;for(var e=0,i=this.graphNodes.length;e<i;e++)this.graphNodes[e].draw();this.fillCheck.isChecked&&t.fill(),t.stroke();for(var s=0,o=this.graphNodes.length;s<o;s++)this.graphNodes[s].drawHelp()},initEvent:function(){var t=this.uiGraph.node;this.node.on(cc.Node.EventType.MOUSE_WHEEL,function(e){var i=e.getScrollY()/120,s=i>0?1.2*t.scale*i:.8*-t.scale*i,o=Math.max(1,Math.min(40,s));t.scale=o,this.feiji.scale=.05*this.baseScale/o,this.updateAddBtnPos()},this),this.node.on(cc.Node.EventType.TOUCH_START,function(){this.setMouseEnterNode(null),this.setMouseSelNode(null),this.creatingNode&&this.setCreatingNode(null)},this),this.node.on(cc.Node.EventType.TOUCH_MOVE,function(e){t.position=t.position.add(e.getDelta())},this),this.node.on(cc.Node.EventType.MOUSE_ENTER,function(){this.posLabel.node.active=!0},this),this.node.on(cc.Node.EventType.MOUSE_MOVE,function(e){var i=e.getLocation(),s=this.node.convertToNodeSpaceAR(i);if(this.posLabel.node.position=s.add(cc.v2(10,-10)),this.qzCheck.isChecked){s=t.convertToNodeSpaceAR(i);var o=cc.v3();cc.Vec3.round(o,s),this.posLabel.string="("+o.x+","+o.y+")"}else{var n=t.convertToNodeSpaceAR(i),c=n.x,r=n.y;this.posLabel.string="("+c.toFixed(2)+","+r.toFixed(2)+")"}this.creatingNode&&(this.creatingNode.updateEP(e),this.creatingNode.updateNextSP())},this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,function(t){switch(t.keyCode){case cc.macro.KEY.escape:this.creatingNode&&this.deleteGNodeByGid(this.creatingNode.gid);break;case cc.macro.KEY.Delete:this.creatingNode?this.deleteGNodeByGid(this.creatingNode.gid):this.mouseSelNode&&this.deleteGNodeByGid(this.mouseSelNode.gid)}},this)},setCreatingNode:function(t){this.creatingNode=t},setMouseEnterNode:function(t){this.mouseEnterNode=t},setMouseSelNode:function(t){this.mouseSelNode=t,t?(this.btnddd.active=!0,this.updateAddBtnPos()):this.btnddd.active=!1,this.optPanel.hide()},updateAddBtnPos:function(){if(this.mouseSelNode){var t=this.node.convertToNodeSpaceAR(this.mouseSelNode.node.convertToWorldSpaceAR(this.mouseSelNode.ep));this.btnddd.position=t.add(cc.v2(20,-20))}},onAddBtnClick:function(t){if(1==this.optPanel.node.active)this.optPanel.hide();else{var e=t.target,i=e.parent.convertToWorldSpaceAR(e.position),s=this.node.convertToNodeSpaceAR(i);this.optPanel.node.position=s,this.optPanel.show()}},closeResultPop:function(){this.resultPop.active=!1},deleteGNodeByGid:function(t){for(var e=0,i=this.graphNodes.length;e<i;e++){var s=this.graphNodes[e];if(s.gid==t){var o=0==i?null:this.graphNodes[e-1],n=i>e+1?this.graphNodes[e+1]:null;if(-1!=s.name.indexOf("move")&&n){if(!o&&-1==n.name.indexOf("move"))return alert("\u65e0\u6cd5\u5220\u9664\u66f2\u7ebf\u8d77\u59cb\u70b9");if(o&&-1!=o.name.indexOf("close"))return alert("\u65e0\u6cd5\u5220\u9664\u66f2\u7ebf\u8d77\u59cb\u70b9")}this.creatingNode&&this.creatingNode.gid==s.gid&&this.setCreatingNode(null),this.mouseSelNode&&this.mouseSelNode.gid==s.gid&&this.setMouseSelNode(null),n&&(n.sp=s.sp,o&&-1!=o.name.indexOf("move")&&-1!=n.name.indexOf("close")&&(this.graphNodes.splice(e+1,1),n.ctr.node.destroy(),n.node.destroy())),this.graphNodes.splice(e,1),s.ctr.node.destroy(),s.node.destroy();break}}},genGNode:function(t,e,i){this.gid++;var s=cc.instantiate(this[e]),o=s.getComponent("graphbase"),n=this.graphNodes,c=n.length;if(this.mouseSelNode){for(var r=0;r<c;r++)if(n[r].gid==this.mouseSelNode.gid){c=r;break}}else c--;var h=c>=0?n[c].ep:cc.v2(0,0);if(!i){switch(e){case"move":case"close":case"line":o.init(this,h,h);break;case"arc":o.init(this,h,h.add(cc.v2(5,5)));break;case"quadratic":o.init(this,h,h,h);break;case"bezier":o.init(this,h,h,h,h)}if("close"==e){for(var a=null,p=c;p>=0;p--){var d=n[p];if(-1!=d.name.indexOf("move")){a=d;break}}o.ep=a.ep}else this.setCreatingNode(o);this.genCtr(e,o,c+1)}return s.parent=this.uiGraph.node,n.splice(c+1,0,o),this.setMouseSelNode(null),o},genCtr:function(t,e,i){var s=cc.instantiate(this[t+"Ctr"]);this.ctrContainer.insertChild(s,i);var o=s.getComponent("ctrbase");return e.setCtr(o),o},genPath:function(){for(var t=[],e=0,i=this.graphNodes.length;e<i;e++){var s=this.graphNodes[e];t.push(s.genPath())}this.resultPop.active=!0,this.resultEdit.string=t.join(" ")},showAction:function(){this.feiji.active=!0,this.feiji.stopAllActions();var t=cc.tween();t.show();for(var e=0,i=this.graphNodes.length;e<i;e++)this.graphNodes[e].showAction(t);t.delay(1),t.hide(),t.target(this.feiji).start()},getAction:function(){for(var t=[],e=0,i=this.graphNodes.length;e<i;e++){var s=this.graphNodes[e];t.push(s.getAction())}var o="\n        function startCurveAction(target) {\n            function bezier2(s,c,e,t) {\n                var t1 = 1 - t\n                return t1 * t1 * s + 2 * t * t1 * c + t * t * e\n            }\n            function bezier3(s,c1,c2,e,t) {\n                var t1 = 1 - t;\n                return t1 * (t1 * (s + (c1 * 3 - s) * t) + c2 * 3 * t * t) + e * t * t * t;\n            }\n            function direction(x1,y1,x2,y2) {\n                let dir = cc.v2(x2 - x1,y2 - y1)\n                let angle = dir.signAngle(cc.v2(1,0))\n                return - angle / Math.PI * 180\n            }\n            let action = cc.tween()\n            "+t.join("\n")+"\n            action.target(target).start()\n        }\n        ";this.resultPop.active=!0,this.resultEdit.string=o}}),cc._RF.pop()},{optpanel:"optpanel"}],arcctr:[function(t,e){"use strict";cc._RF.push(e,"cf69500D0tIfKSyEaFLLjXg","arcctr"),cc.Class({extends:t("ctrbase"),properties:{cpx:t("posinput"),cpy:t("posinput"),counterclockwise:cc.Toggle},init:function(t){this._super(t),this.cpx.init(t.cp.x,this.onValueChange.bind(this)),this.cpy.init(t.cp.y,this.onValueChange.bind(this)),t.counterclockwise?this.counterclockwise.check():this.counterclockwise.uncheck()},updateGNode:function(){var t=this.cpx.editBox.string,e=this.cpy.editBox.string;this._super(),this.gcom.cp=this.getPos(t,e,this.gcom.cp)},onToggle:function(t){this.gcom.counterclockwise=t.isChecked}}),cc._RF.pop()},{ctrbase:"ctrbase",posinput:"posinput"}],arc:[function(t,e){"use strict";cc._RF.push(e,"7f989ReaA9Pv62GIvW+B360","arc"),cc.Class({extends:t("graphbase"),properties:{centerNode:cc.Node,sp:{visible:!1,override:!0,get:function(){return this._sp},set:function(t){this._sp=t,this.fixEP()}},_cp:{default:cc.v2(0,0),serializable:!1},cp:{visible:!1,get:function(){return this._cp},set:function(t){this._cp=t,this.centerNode.position=this._cp,this.ctr&&this.ctr.updateFromGnode("cp"),this.fixEP()}}},init:function(t,e,i,s){var o=i.sub(e);this.cp=e.add(o.div(2)),this._super(t,e,i),this.counterclockwise=!!s,this.centerNode.on(cc.Node.EventType.MOUSE_ENTER,function(){cc.game.canvas.style.cursor="pointer",this.edit.setMouseEnterNode(this)},this),this.centerNode.on(cc.Node.EventType.MOUSE_LEAVE,function(){cc.game.canvas.style.cursor="auto",this.edit.setMouseEnterNode(null)},this),this.centerNode.on(cc.Node.EventType.TOUCH_START,function(t){this.edit.setMouseSelNode(this),t.stopPropagation()},this),this.centerNode.on(cc.Node.EventType.TOUCH_MOVE,function(t){if(t.stopPropagation(),this.edit.qzCheck.isChecked){var e=t.getLocation(),i=this.node.convertToNodeSpaceAR(e),s=cc.v3();cc.Vec3.round(s,i),this.cp=s}else{var o=this.edit.uiGraph.node.scale;this.cp=this.cp.add(t.getDelta().scale(cc.v2(1/o,1/o)))}this.edit.updateAddBtnPos()},this)},updateEP:function(t){this._super(t),this.fixEP()},fixEP:function(){var t=this.cp.sub(this.sp).mag();this.ep=this.ep.sub(this.cp).normalize().mul(t).add(this.cp)},updateScale:function(t){this._super(t);var e=20*this.edit.handleWidth/t;this.centerNode.width=e,this.centerNode.height=e},draw:function(){var t=this.edit.uiGraph,e=cc.v2(this.sp.x,this.sp.y),i=cc.v2(this.ep.x,this.ep.y),s=this.cp,o=s.sub(e),n=e.sub(s),c=i.sub(s).signAngle(cc.v2(5,0)),r=n.signAngle(cc.v2(5,0));t.arc(s.x,s.y,o.mag(),-r,-c,this.counterclockwise)},drawHelp:function(){this._super();var t=this.edit.uiGraph;t.strokeColor=this.edit.ctrlColor,t.moveTo(this.sp.x,this.sp.y),t.lineTo(this.cp.x,this.cp.y),t.lineTo(this.ep.x,this.ep.y),t.stroke()},mouseSel:function(){this._super(),this.centerNode.color=this.edit.mouseSelColor;var t=this.edit.uiGraph;t.strokeColor=this.edit.mouseSelColor;var e=cc.v2(this.sp.x,this.sp.y),i=cc.v2(this.ep.x,this.ep.y),s=this.cp,o=s.sub(e),n=e.sub(s),c=i.sub(s).signAngle(cc.v2(5,0)),r=n.signAngle(cc.v2(5,0));t.arc(s.x,s.y,o.mag(),-r,-c,this.counterclockwise),t.stroke()},mouseEnter:function(){this._super(),this.centerNode.color=this.edit.mouseEnterColor;var t=this.edit.uiGraph;t.strokeColor=this.edit.mouseEnterColor;var e=cc.v2(this.sp.x,this.sp.y),i=cc.v2(this.ep.x,this.ep.y),s=this.cp,o=s.sub(e),n=e.sub(s),c=i.sub(s).signAngle(cc.v2(5,0)),r=n.signAngle(cc.v2(5,0));t.arc(s.x,s.y,o.mag(),-r,-c,this.counterclockwise),t.stroke()},mouseNone:function(){this._super(),this.centerNode.color=this.edit.ctrlColor},genPath:function(){var t=this.cp,e=t.x,i=t.y,s=cc.v2(this.sp.x,this.sp.y),o=cc.v2(this.ep.x,this.ep.y),n=this.cp,c=n.sub(s).mag(),r=s.sub(n),h=o.sub(n),a=-r.signAngle(cc.v2(5,0)),p=-h.signAngle(cc.v2(5,0)),d=!this.counterclockwise;if(a===p)return"";(a%=2*Math.PI)==(p%=2*Math.PI)&&(p=(p+2*Math.PI-.001*(d?-1:1))%(2*Math.PI));var u=e+c*Math.cos(p),l=i+c*Math.sin(p),g=(Math.cos(a),Math.sin(a),d?0:1),v=p-a;return v<0&&(v+=2*Math.PI),["A",c,c,0,d?v>Math.PI?0:1:v>Math.PI?1:0,g,u,l].join(" ")},showAction:function(t){var e=this,i=cc.v2(this.sp.x,this.sp.y),s=cc.v2(this.ep.x,this.ep.y),o=this.cp,n=o.sub(i).mag(),c=i.sub(o),r=s.sub(o),h=-c.signAngle(cc.v2(5,0)),a=-r.signAngle(cc.v2(5,0))-h;a>0?this.counterclockwise||(a-=2*Math.PI):this.counterclockwise&&(a+=2*Math.PI);var p,d,u=i.x,l=i.y;t.to(1,{position:{value:s,progress:function(t,e,i,s){var c=h+a*s;return i.x=o.x+n*Math.cos(c),i.y=o.y+n*Math.sin(c),p=i.x,d=i.y,i}},angle:{value:0,progress:function(){var t=e.direction(u,l,p,d);return u=p,l=d,t}}})},getAction:function(){var t=cc.v2(this.sp.x,this.sp.y),e=cc.v2(this.ep.x,this.ep.y),i=this.cp,s=i.sub(t).mag(),o=t.sub(i),n=e.sub(i),c=-o.signAngle(cc.v2(5,0)),r=-n.signAngle(cc.v2(5,0))-c;return r>0?this.counterclockwise||(r-=2*Math.PI):this.counterclockwise&&(r+=2*Math.PI),"\n        (function () {\n            let prex = "+t.x+", prey = "+t.y+", x, y\n            action.to(1,{ \n                position: {\n                    value: cc.v2("+e.x+","+e.y+"),\n                    progress: (start, end, current, ratio) => {\n                        let angle = "+c+" + "+r+" * ratio\n                        current.x = "+i.x+" + "+s+" * Math.cos(angle)\n                        current.y = "+i.y+" + "+s+" * Math.sin(angle)\n                        x = current.x\n                        y = current.y\n                        return current\n                    }\n                },\n                angle: {\n                    value: 0,\n                    progress: (start, end, current, ratio) => {\n                        let angle = direction(prex,prey,x,y)\n                        prex = x\n                        prey = y\n                        return angle\n                    }\n                }\n            })\n        })();\n        "}}),cc._RF.pop()},{graphbase:"graphbase"}],bezierctr:[function(t,e){"use strict";cc._RF.push(e,"7bf2bBo3FNLna5VSFwt6J12","bezierctr"),cc.Class({extends:t("ctrbase"),properties:{cp1x:t("posinput"),cp1y:t("posinput"),cp2x:t("posinput"),cp2y:t("posinput")},init:function(t){this._super(t),this.cp1x.init(t.cp1.x,this.onValueChange.bind(this)),this.cp1y.init(t.cp1.y,this.onValueChange.bind(this)),this.cp2x.init(t.cp2.x,this.onValueChange.bind(this)),this.cp2y.init(t.cp2.y,this.onValueChange.bind(this))},updateGNode:function(){this.gcom.cp1=this.getPos(this.cp1x.editBox.string,this.cp1y.editBox.string,this.gcom.cp1),this.gcom.cp2=this.getPos(this.cp2x.editBox.string,this.cp2y.editBox.string,this.gcom.cp2),this._super()}}),cc._RF.pop()},{ctrbase:"ctrbase",posinput:"posinput"}],bezier:[function(t,e){"use strict";cc._RF.push(e,"53e8b5xoL1JvaJcjl7s0eRc","bezier"),cc.Class({extends:t("graphbase"),properties:{ctrl1Node:cc.Node,ctrl2Node:cc.Node,_cp1:{default:cc.v2(0,0),serializable:!1},cp1:{visible:!1,get:function(){return this._cp1},set:function(t){this._cp1=t,this.ctrl1Node.position=this._cp1,this.ctr&&this.ctr.updateFromGnode("cp1")}},_cp2:{default:cc.v2(0,0),serializable:!1},cp2:{visible:!1,get:function(){return this._cp2},set:function(t){this._cp2=t,this.ctrl2Node.position=this._cp2,this.ctr&&this.ctr.updateFromGnode("cp2")}}},init:function(t,e,i,s,o){this._super(t,e,o),this.cp1=i,this.cp2=s,this.ctrl1Node.on(cc.Node.EventType.MOUSE_ENTER,function(){cc.game.canvas.style.cursor="pointer",this.edit.setMouseEnterNode(this)},this),this.ctrl1Node.on(cc.Node.EventType.MOUSE_LEAVE,function(){cc.game.canvas.style.cursor="auto",this.edit.setMouseEnterNode(null)},this),this.ctrl1Node.on(cc.Node.EventType.TOUCH_START,function(t){this.edit.setMouseSelNode(this),t.stopPropagation()},this),this.ctrl1Node.on(cc.Node.EventType.TOUCH_MOVE,function(t){if(t.stopPropagation(),this.edit.qzCheck.isChecked){var e=t.getLocation(),i=this.node.convertToNodeSpaceAR(e),s=cc.v3();cc.Vec3.round(s,i),this.cp1=s}else{var o=this.edit.uiGraph.node.scale;this.cp1=this.cp1.add(t.getDelta().scale(cc.v2(1/o,1/o)))}},this),this.ctrl2Node.on(cc.Node.EventType.MOUSE_ENTER,function(){cc.game.canvas.style.cursor="pointer",this.edit.setMouseEnterNode(this)},this),this.ctrl2Node.on(cc.Node.EventType.MOUSE_LEAVE,function(){cc.game.canvas.style.cursor="auto",this.edit.setMouseEnterNode(null)},this),this.ctrl2Node.on(cc.Node.EventType.TOUCH_START,function(t){this.edit.setMouseSelNode(this),t.stopPropagation()},this),this.ctrl2Node.on(cc.Node.EventType.TOUCH_MOVE,function(t){if(t.stopPropagation(),this.edit.qzCheck.isChecked){var e=t.getLocation(),i=this.node.convertToNodeSpaceAR(e),s=cc.v3();cc.Vec3.round(s,i),this.cp2=s}else{var o=this.edit.uiGraph.node.scale;this.cp2=this.cp2.add(t.getDelta().scale(cc.v2(1/o,1/o)))}},this)},updateScale:function(t){this._super(t);var e=20*this.edit.handleWidth/t;this.ctrl1Node.width=e,this.ctrl1Node.height=e,this.ctrl2Node.width=e,this.ctrl2Node.height=e},draw:function(){this.edit.uiGraph.bezierCurveTo(this.cp1.x,this.cp1.y,this.cp2.x,this.cp2.y,this.ep.x,this.ep.y)},drawHelp:function(){this._super();var t=this.edit.uiGraph;t.strokeColor=this.edit.ctrlColor,t.moveTo(this.sp.x,this.sp.y),t.lineTo(this.cp1.x,this.cp1.y),t.moveTo(this.ep.x,this.ep.y),t.lineTo(this.cp2.x,this.cp2.y),t.stroke()},mouseSel:function(){this._super(),this.ctrl1Node.color=this.edit.mouseSelColor,this.ctrl2Node.color=this.edit.mouseSelColor;var t=this.edit.uiGraph;t.strokeColor=this.edit.mouseSelColor,t.moveTo(this.sp.x,this.sp.y),t.bezierCurveTo(this.cp1.x,this.cp1.y,this.cp2.x,this.cp2.y,this.ep.x,this.ep.y),t.stroke()},mouseEnter:function(){this._super(),this.ctrl1Node.color=this.edit.mouseEnterColor,this.ctrl2Node.color=this.edit.mouseEnterColor;var t=this.edit.uiGraph;t.strokeColor=this.edit.mouseEnterColor,t.moveTo(this.sp.x,this.sp.y),t.bezierCurveTo(this.cp1.x,this.cp1.y,this.cp2.x,this.cp2.y,this.ep.x,this.ep.y),t.stroke()},mouseNone:function(){this._super(),this.ctrl1Node.color=this.edit.ctrlColor,this.ctrl2Node.color=this.edit.ctrlColor},bezier:function(t,e,i,s,o){var n=1-o;return n*(n*(t+(3*e-t)*o)+3*i*o*o)+s*o*o*o},genPath:function(){return["C",this.cp1.x,this.cp1.y,this.cp2.x,this.cp2.y,this.ep.x,this.ep.y].join(" ")},showAction:function(t){var e,i,s=this,o=this,n=this.sp.x,c=this.sp.y;t.to(1,{position:{value:this.ep,progress:function(t,s,n,c){return n.x=o.bezier(t.x,o.cp1.x,o.cp2.x,s.x,c),n.y=o.bezier(t.y,o.cp1.y,o.cp2.y,s.y,c),e=n.x,i=n.y,n}},angle:{value:180,progress:function(){var t=s.direction(n,c,e,i);return n=e,c=i,t}}})},getAction:function(){return"\n        (function () {\n            let prex = "+this.sp.x+", prey = "+this.sp.y+", x, y\n            action.to(1,{ \n                position: {\n                    value: cc.v2("+this.ep.x+","+this.ep.y+"),\n                    progress: (start, end, current, ratio) => {\n                        current.x = bezier3(start.x,"+this.cp1.x+","+this.cp2.x+",end.x,ratio)\n                        current.y = bezier3(start.y,"+this.cp1.y+","+this.cp2.y+",end.y,ratio)\n                        x = current.x\n                        y = current.y\n                        return current\n                    }\n                },\n                angle: {\n                    value: 0,\n                    progress: (start, end, current, ratio) => {\n                        let angle = direction(prex,prey,x,y)\n                        prex = x\n                        prey = y\n                        return angle\n                    }\n                },\n            })\n        })();\n        "}}),cc._RF.pop()},{graphbase:"graphbase"}],close:[function(t,e){"use strict";cc._RF.push(e,"a8e19n9MoBAhqx4RFSoQucJ","close"),cc.Class({extends:t("graphbase"),updateNextSP:function(){},draw:function(){this.edit.uiGraph.close()},mouseSel:function(){this._super();var t=this.edit.uiGraph;t.strokeColor=this.edit.mouseSelColor,t.moveTo(this.sp.x,this.sp.y),t.lineTo(this.ep.x,this.ep.y),t.stroke()},mouseEnter:function(){this._super();var t=this.edit.uiGraph;t.strokeColor=this.edit.mouseEnterColor,t.moveTo(this.sp.x,this.sp.y),t.lineTo(this.ep.x,this.ep.y),t.stroke()},genPath:function(){return"Z"},showAction:function(t){var e=this.direction(this.sp.x,this.sp.y,this.ep.x,this.ep.y);t.parallel(cc.tween().set({angle:e}),cc.tween().to(1,{position:cc.v2(this.ep.x,this.ep.y)}))},getAction:function(){return"action.parallel(\n            cc.tween().set({ angle: "+this.direction(this.sp.x,this.sp.y,this.ep.x,this.ep.y)+" }),\n            cc.tween().to(1, { position: cc.v2("+this.ep.x+","+this.ep.y+") })\n        );"}}),cc._RF.pop()},{graphbase:"graphbase"}],ctrbase:[function(t,e){"use strict";cc._RF.push(e,"2a5edOywBZHKYZmwk4zuENX","ctrbase"),cc.Class({extends:cc.Component,properties:{epx:t("posinput"),epy:t("posinput"),bg:cc.Node},onLoad:function(){this.node.on(cc.Node.EventType.MOUSE_ENTER,function(){cc.game.canvas.style.cursor="pointer",this.gcom&&this.gcom.onCtrMouseEnter()},this,!0),this.node.on(cc.Node.EventType.MOUSE_LEAVE,function(){cc.game.canvas.style.cursor="auto",this.gcom&&this.gcom.onCtrMouseLeave()},this,!0)},init:function(t){this.gcom=t,this.epx.init(t.ep.x,this.onValueChange.bind(this)),this.epy.init(t.ep.y,this.onValueChange.bind(this))},onValueChange:function(t){"text-changed"==t?this.updateGNode():"editing-did-began"==t&&this.onClick()},updateGNode:function(){this.gcom.setEP(this.getPos(this.epx.editBox.string,this.epy.editBox.string,this.gcom.ep))},updateFromGnode:function(t){this[t+"x"].editBox.string=this.gcom[t].x.toFixed(2),this[t+"y"].editBox.string=this.gcom[t].y.toFixed(2)},getPos:function(t,e,i){var s=cc.v2(),o=parseFloat(t);isNaN(o)?s.x=i.x:s.x=o;var n=parseFloat(e);return isNaN(o)?s.y=i.y:s.y=n,s},onClick:function(){this.gcom&&this.gcom.onCtrSelect()}}),cc._RF.pop()},{posinput:"posinput"}],graphbase:[function(t,e){"use strict";cc._RF.push(e,"6fb9a4DE9hGxLdtCDnkdkMF","graphbase"),cc.Class({extends:cc.Component,properties:{endNode:cc.Node,_sp:{default:cc.v2(0,0),serializable:!1},sp:{visible:!1,get:function(){return this._sp},set:function(t){this._sp=t}},_ep:{default:cc.v2(0,0),serializable:!1},ep:{visible:!1,get:function(){return this._ep},set:function(t){this._ep=t,this.endNode.position=this.ep,this.ctr&&this.ctr.updateFromGnode("ep")}}},setCtr:function(t){this.ctr=t,t.init(this)},init:function(t,e,i){this.edit=t,this.gid=this.edit.gid,this.sp=e,this.ep=i;var s=this.edit.uiGraph.node;this.endNode.on(cc.Node.EventType.MOUSE_ENTER,function(){cc.game.canvas.style.cursor="pointer",this.edit.setMouseEnterNode(this)},this),this.endNode.on(cc.Node.EventType.MOUSE_LEAVE,function(){cc.game.canvas.style.cursor="auto",this.edit.setMouseEnterNode(null)},this),this.endNode.on(cc.Node.EventType.TOUCH_START,function(t){this.edit.setMouseSelNode(this),this.edit.creatingNode&&this.gid==this.edit.creatingNode.gid||t.stopPropagation()},this),this.endNode.on(cc.Node.EventType.TOUCH_MOVE,this.onEPTouchMove,this),s.on("scale-changed",function(){this.updateScale(s.scale)},this),this.updateScale(s.scale)},onEPTouchMove:function(t){t.stopPropagation(),this.updateEP(t),this.updateNextSP(),this.edit.updateAddBtnPos()},updateScale:function(t){var e=20*this.edit.handleWidth/t;this.endNode.width=e,this.endNode.height=e},updateEP:function(t){if(this.edit.qzCheck.isChecked){var e=t.getLocation(),i=this.node.convertToNodeSpaceAR(e),s=cc.v3();cc.Vec3.round(s,i),this.ep=s}else{var o=this.edit.uiGraph.node.scale;this.ep=this.ep.add(t.getDelta().scale(cc.v2(1/o,1/o)))}},updateNextSP:function(){for(var t=0,e=this.edit.graphNodes.length;t<e;t++)if(this.edit.graphNodes[t].gid==this.gid){e>t+1&&(this.edit.graphNodes[t+1].sp=this.ep);break}},setEP:function(t){this.ep=t,this.updateNextSP(),this.edit.updateAddBtnPos()},onCtrMouseEnter:function(){this.edit.setMouseEnterNode(this)},onCtrMouseLeave:function(){this.edit.setMouseEnterNode(null)},onCtrSelect:function(){this.edit.setMouseSelNode(this)},draw:function(){},drawHelp:function(){this.edit.mouseSelNode&&this.edit.mouseSelNode.gid==this.gid?this.mouseSel():this.edit.mouseEnterNode&&this.edit.mouseEnterNode.gid==this.gid?this.mouseEnter():this.mouseNone()},mouseSel:function(){this.endNode.color=this.edit.mouseSelColor,this.ctr&&(this.ctr.bg.opacity=100)},mouseEnter:function(){this.endNode.color=this.edit.mouseEnterColor,this.ctr&&(this.ctr.bg.opacity=100)},mouseNone:function(){this.endNode.color=this.edit.pointColor,this.ctr&&(this.ctr.bg.opacity=0)},direction:function(t,e,i,s){return-cc.v2(i-t,s-e).signAngle(cc.v2(1,0))/Math.PI*180},genPath:function(){return""},showAction:function(){},getAction:function(){return""}}),cc._RF.pop()},{}],hover:[function(t,e){"use strict";cc._RF.push(e,"d14ecEq1v1JUb6cTKfClo9B","hover"),cc.Class({extends:cc.Component,properties:{pointType:"pointer",mouseEnterHandler:cc.Component.EventHandler,mouseLeaveHandler:cc.Component.EventHandler},onLoad:function(){this.node.on(cc.Node.EventType.MOUSE_ENTER,function(t){cc.game.canvas.style.cursor=this.pointType,this.mouseEnterHandler&&this.mouseEnterHandler.target&&this.mouseEnterHandler.emit([t])},this),this.node.on(cc.Node.EventType.MOUSE_LEAVE,function(t){cc.game.canvas.style.cursor="auto",this.mouseLeaveHandler&&this.mouseLeaveHandler.target&&this.mouseLeaveHandler.emit([t])},this)}}),cc._RF.pop()},{}],line:[function(t,e){"use strict";cc._RF.push(e,"621aecCbi9GBo/+pyiAeKK6","line"),cc.Class({extends:t("graphbase"),draw:function(){this.edit.uiGraph.lineTo(this.ep.x,this.ep.y)},mouseSel:function(){this._super();var t=this.edit.uiGraph;t.strokeColor=this.edit.mouseSelColor,t.moveTo(this.sp.x,this.sp.y),t.lineTo(this.ep.x,this.ep.y),t.stroke()},mouseEnter:function(){this._super();var t=this.edit.uiGraph;t.strokeColor=this.edit.mouseEnterColor,t.moveTo(this.sp.x,this.sp.y),t.lineTo(this.ep.x,this.ep.y),t.stroke()},genPath:function(){return["L",this.ep.x,this.ep.y].join(" ")},showAction:function(t){var e=this.direction(this.sp.x,this.sp.y,this.ep.x,this.ep.y);t.parallel(cc.tween().set({angle:e}),cc.tween().to(1,{position:cc.v2(this.ep.x,this.ep.y)}))},getAction:function(){return"action.parallel(\n            cc.tween().set({ angle: "+this.direction(this.sp.x,this.sp.y,this.ep.x,this.ep.y)+" }),\n            cc.tween().to(1, { position: cc.v2("+this.ep.x+","+this.ep.y+") })\n        );"}}),cc._RF.pop()},{graphbase:"graphbase"}],move:[function(t,e){"use strict";cc._RF.push(e,"e90a9obCfNNJqMFKSNZeaeb","move"),cc.Class({extends:t("graphbase"),updateNextSP:function(){this._super();for(var t=!1,e=0,i=this.edit.graphNodes.length;e<i;e++){var s=this.edit.graphNodes[e];if(s.gid!=this.gid){if(t){if(-1!=s.name.indexOf("move"))break;if(-1!=s.name.indexOf("close")){s.ep=this.ep;break}}}else t=!0}},draw:function(){this.edit.uiGraph.moveTo(this.ep.x,this.ep.y)},genPath:function(){return["M",this.ep.x,this.ep.y].join(" ")},showAction:function(t){t.set({position:cc.v2(this.ep.x,this.ep.y)})},getAction:function(){return"action.set({ position: cc.v2("+this.ep.x+","+this.ep.y+") });"}}),cc._RF.pop()},{graphbase:"graphbase"}],optpanel:[function(t,e){"use strict";function i(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(i)return(i=i.call(t)).next.bind(i);if(Array.isArray(t)||(i=s(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var o=0;return function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function s(t,e){if(t){if("string"==typeof t)return o(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?o(t,e):void 0}}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,s=new Array(e);i<e;i++)s[i]=t[i];return s}cc._RF.push(e,"32945gdjqZHjoypgE5lH96h","optpanel"),cc.Class({extends:cc.Component,properties:{dyBtns:[cc.Button]},init:function(t){this.edit=t},show:function(){for(var t,e=this.edit,s=e.graphNodes,o=s.length,n=i(this.dyBtns);!(t=n()).done;)t.value.interactable=o>0;if(e.mouseSelNode){if(-1!=e.mouseSelNode.name.indexOf("close"))this.dyBtns[0].interactable=!1,this.dyBtns[1].interactable=!1,this.dyBtns[2].interactable=!1,this.dyBtns[3].interactable=!1,this.dyBtns[4].interactable=!1;else for(var c=0;c<o;c++)if(s[c].gid==e.mouseSelNode.gid){o>c+1&&-1==s[c+1].name.indexOf("move")&&(this.dyBtns[4].interactable=!1);break}}else o>0&&-1!=s[o-1].name.indexOf("close")&&(this.dyBtns[4].interactable=!1);this.node.active=!0},hide:function(){this.node.active=!1},mouseEnter:function(t){t.target.color=cc.color(21,85,149)},mouseLeave:function(t){t.target.color=cc.color(8,127,246)},onDeleteBtnClick:function(){this.edit.mouseSelNode&&this.edit.deleteGNodeByGid(this.edit.mouseSelNode.gid)}}),cc._RF.pop()},{}],posinput:[function(t,e){"use strict";cc._RF.push(e,"1d71cWuO8hMM5JO9kH3Ag8h","posinput"),cc.Class({extends:cc.Component,properties:{editBox:cc.EditBox,hoverLabel:cc.Label,hover:cc.Node},onLoad:function(){this.hoverLabel.string=this.node.name},init:function(t,e){this.editBox.string=t,this.callback=e},mouseEnter:function(){this.hover.active=!0},mouseLeave:function(){this.hover.active=!1},onEditingDidBegan:function(){this.callback&&this.callback("editing-did-began",this)},onTextChanged:function(t){t=parseFloat(t),!isNaN(t)&&this.callback&&this.callback("text-changed",this,t)},onEditingDidEnded:function(){this.callback&&this.callback("editing-did-ended",this)}}),cc._RF.pop()},{}],quadraticctr:[function(t,e){"use strict";cc._RF.push(e,"114feGc5NpOZ5Hd2txEdg1N","quadraticctr"),cc.Class({extends:t("ctrbase"),properties:{cpx:t("posinput"),cpy:t("posinput")},init:function(t){this._super(t),this.cpx.init(t.cp.x,this.onValueChange.bind(this)),this.cpy.init(t.cp.y,this.onValueChange.bind(this))},updateGNode:function(){this.gcom.cp=this.getPos(this.cpx.editBox.string,this.cpy.editBox.string,this.gcom.cp),this._super()}}),cc._RF.pop()},{ctrbase:"ctrbase",posinput:"posinput"}],quadratic:[function(t,e){"use strict";cc._RF.push(e,"74907/tTrdHlL5UD34lFVGS","quadratic"),cc.Class({extends:t("graphbase"),properties:{ctrlNode:cc.Node,_cp:{default:cc.v2(0,0),serializable:!1},cp:{visible:!1,get:function(){return this._cp},set:function(t){this._cp=t,this.ctrlNode.position=this._cp,this.ctr&&this.ctr.updateFromGnode("cp")}}},init:function(t,e,i,s){this._super(t,e,s),this.cp=i,this.ctrlNode.on(cc.Node.EventType.MOUSE_ENTER,function(){cc.game.canvas.style.cursor="pointer",this.edit.setMouseEnterNode(this)},this),this.ctrlNode.on(cc.Node.EventType.MOUSE_LEAVE,function(){cc.game.canvas.style.cursor="auto",this.edit.setMouseEnterNode(null)},this),this.ctrlNode.on(cc.Node.EventType.TOUCH_START,function(t){this.edit.setMouseSelNode(this),t.stopPropagation()},this),this.ctrlNode.on(cc.Node.EventType.TOUCH_MOVE,function(t){if(t.stopPropagation(),this.edit.qzCheck.isChecked){var e=t.getLocation(),i=this.node.convertToNodeSpaceAR(e),s=cc.v3();cc.Vec3.round(s,i),this.cp=s}else{var o=this.edit.uiGraph.node.scale;this.cp=this.cp.add(t.getDelta().scale(cc.v2(1/o,1/o)))}},this)},updateScale:function(t){this._super(t);var e=20*this.edit.handleWidth/t;this.ctrlNode.width=e,this.ctrlNode.height=e},draw:function(){this.edit.uiGraph.quadraticCurveTo(this.cp.x,this.cp.y,this.ep.x,this.ep.y)},drawHelp:function(){this._super();var t=this.edit.uiGraph;t.strokeColor=this.edit.ctrlColor,t.moveTo(this.sp.x,this.sp.y),t.lineTo(this.cp.x,this.cp.y),t.lineTo(this.ep.x,this.ep.y),t.stroke()},mouseSel:function(){this._super(),this.ctrlNode.color=this.edit.mouseSelColor;var t=this.edit.uiGraph;t.strokeColor=this.edit.mouseSelColor,t.moveTo(this.sp.x,this.sp.y),t.quadraticCurveTo(this.cp.x,this.cp.y,this.ep.x,this.ep.y),t.stroke()},mouseEnter:function(){this._super(),this.ctrlNode.color=this.edit.mouseEnterColor;var t=this.edit.uiGraph;t.strokeColor=this.edit.mouseEnterColor,t.moveTo(this.sp.x,this.sp.y),t.quadraticCurveTo(this.cp.x,this.cp.y,this.ep.x,this.ep.y),t.stroke()},mouseNone:function(){this._super(),this.ctrlNode.color=this.edit.ctrlColor},bezier:function(t,e,i,s){var o=1-s;return o*o*t+2*s*o*e+s*s*i},genPath:function(){return["Q",this.cp.x,this.cp.y,this.ep.x,this.ep.y].join(" ")},showAction:function(t){var e,i,s=this,o=this,n=this.sp.x,c=this.sp.y;t.to(1,{position:{value:this.ep,progress:function(t,s,n,c){return n.x=o.bezier(t.x,o.cp.x,s.x,c),n.y=o.bezier(t.y,o.cp.y,s.y,c),e=n.x,i=n.y,n}},angle:{value:0,progress:function(){var t=s.direction(n,c,e,i);return n=e,c=i,t}}})},getAction:function(){return"\n        (function () {\n            let prex = "+this.sp.x+", prey = "+this.sp.y+", x, y\n            action.to(1,{ \n                position: {\n                    value: cc.v2("+this.ep.x+","+this.ep.y+"),\n                    progress: (start, end, current, ratio) => {\n                        current.x = bezier2(start.x,"+this.cp.x+",end.x,ratio)\n                        current.y = bezier2(start.y,"+this.cp.y+",end.y,ratio)\n                        x = current.x\n                        y = current.y\n                        return current\n                    }\n                },\n                angle: {\n                    value: 0,\n                    progress: (start, end, current, ratio) => {\n                        let angle = direction(prex,prey,x,y)\n                        prex = x\n                        prey = y\n                        return angle\n                    }\n                },\n            })\n        })();\n        "}}),cc._RF.pop()},{graphbase:"graphbase"}]},{},["arc","arcctr","bezier","bezierctr","close","ctrbase","graphbase","hover","line","move","optpanel","posinput","quadratic","quadraticctr","GraphicsEdit"]);